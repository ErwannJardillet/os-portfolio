# Story 4.1: App Projets - API GitHub

## Status
Draft

## Story

**As a** visiteur du portfolio,  
**I want** voir mes projets GitHub affichés dynamiquement dans l'app Projets,  
**so that** le contenu soit à jour automatiquement sans redéploiement.

## Contexte et objectif

### Contexte
L'app Projets affiche actuellement du contenu statique. Cette story l'enrichit avec des données réelles depuis l'API GitHub.

### Objectif
Intégrer l'API GitHub pour récupérer les repositories publics d'un utilisateur, les afficher dans l'app Projets avec filtres et recherche.

### Relation au lot
Cette story fait partie du **Lot 4 : Apps enrichies** et améliore significativement la valeur du portfolio.

## Scope précis

### In Scope ✅
- Service GitHub API (fetch repos publics)
- Cache localStorage (TTL 1h)
- Affichage repos dans app Projets (cards)
- Filtres : recherche texte, filtre par langage
- États UI : loading, success, error, empty
- Gestion erreurs (network, rate limit, timeout)

### Out of Scope ❌
- Authentification GitHub (repos publics uniquement)
- Pagination (limiter à 30-50 repos max)
- Détails repo (issues, PRs) - juste liste repos

## Acceptance Criteria

1. **AC1 - Service GitHub API**
   - Service `githubService.js` créé
   - Fetch repos publics : `GET /users/{username}/repos`
   - Cache localStorage (key: `github-repos-{username}`, TTL: 1h)

2. **AC2 - Affichage repos**
   - App Projets affiche repos en cards
   - Informations : nom, description, stars, forks, langage, date mise à jour
   - Design cohérent avec thème (glassmorphism)

3. **AC3 - Filtres**
   - Filtre recherche texte (nom, description)
   - Filtre par langage (dropdown)
   - Filtrage client-side (pas de nouvelle requête API)

4. **AC4 - États UI**
   - Loading : skeleton ou spinner pendant fetch
   - Success : liste repos affichée
   - Empty : message "Aucun repository public"
   - Error : message erreur + bouton réessayer

5. **AC5 - Gestion erreurs**
   - Network error : message + bouton réessayer + cache fallback
   - Rate limit : message + utilisation cache si disponible
   - Timeout : timeout 10s, message erreur si dépassé
   - 404 user : message "Utilisateur GitHub non trouvé"

## Impacts

### Fichiers/Modules à créer
- `src/services/githubService.js` - Service fetch + cache GitHub API
- `src/apps/Projects/ProjectCard.jsx` - Composant card repo
- `src/apps/Projects/ProjectFilters.jsx` - Composant filtres
- `src/apps/Projects/ProjectList.jsx` - Composant liste repos

### Fichiers à modifier
- `src/apps/Projects/Projects.jsx` - Intégrer fetch GitHub, filtres, affichage
- `src/apps/Projects/Projects.module.css` - Styles cards, filtres

### Endpoints
**GitHub API** - `GET https://api.github.com/users/{username}/repos`
- Authentication : Aucune (repos publics)
- Rate Limiting : 60 requêtes/heure (sans auth)

### Base de données
**localStorage** - Cache repos GitHub
- Key: `github-repos-{username}`
- Value: `{ repos: GitHubRepo[], timestamp: number, username: string }`
- TTL: 1 heure

### Dépendances npm
**Aucune nouvelle** - Fetch natif, localStorage natif

## Tasks / Subtasks

- [ ] **Task 1: Service GitHub API** (AC: 1)
  - [ ] Créer `src/services/githubService.js`
  - [ ] Fonction `fetchUserRepos(username)` : fetch API GitHub
  - [ ] Fonction `getCachedRepos(username)` : lire cache localStorage
  - [ ] Fonction `cacheRepos(username, repos)` : sauvegarder cache
  - [ ] Logique : vérifier cache, si valide retourner, sinon fetch + cache
  - [ ] Gestion TTL (1h)

- [ ] **Task 2: Composant ProjectCard** (AC: 2)
  - [ ] Créer `src/apps/Projects/ProjectCard.jsx`
  - [ ] Afficher : nom, description, stars, forks, langage, date
  - [ ] Lien externe vers repo GitHub (html_url)
  - [ ] Style glassmorphism cohérent

- [ ] **Task 3: Composant ProjectFilters** (AC: 3)
  - [ ] Créer `src/apps/Projects/ProjectFilters.jsx`
  - [ ] Input recherche texte
  - [ ] Dropdown filtre langage (liste langages uniques des repos)
  - [ ] Filtrage client-side (pas de nouvelle requête)

- [ ] **Task 4: Composant ProjectList** (AC: 2)
  - [ ] Créer `src/apps/Projects/ProjectList.jsx`
  - [ ] Afficher liste ProjectCard
  - [ ] Gérer empty state (aucun repo)

- [ ] **Task 5: Intégration Projects.jsx** (AC: 2, 4, 5)
  - [ ] Modifier `src/apps/Projects/Projects.jsx`
  - [ ] État : `repos`, `loading`, `error`, `filters`
  - [ ] useEffect : fetch repos au mount (ou au clic bouton)
  - [ ] Intégrer ProjectFilters, ProjectList
  - [ ] Gérer états UI (loading, error, empty, success)

- [ ] **Task 6: Gestion erreurs** (AC: 5)
  - [ ] Try/catch autour fetch
  - [ ] Gérer network error (message + bouton réessayer)
  - [ ] Gérer rate limit (message + cache fallback)
  - [ ] Timeout 10s (AbortController)
  - [ ] Gérer 404 user (message spécifique)

- [ ] **Task 7: Tests** (AC: 1, 3, 5)
  - [ ] Test fetch repos fonctionne
  - [ ] Test cache localStorage (sauvegarde + restauration)
  - [ ] Test filtres (recherche, langage)
  - [ ] Test gestion erreurs

## Dev Notes

### Architecture technique

**Source: design-solution-par-lot.md#Lot-4**

#### Schéma API GitHub Repository
```typescript
type GitHubRepo = {
  id: number;
  name: string;
  full_name: string;
  description: string | null;
  html_url: string;
  stargazers_count: number;
  forks_count: number;
  language: string | null;
  updated_at: string;
  topics: string[];
};
```

#### Cache localStorage
```javascript
// Structure cache
{
  repos: GitHubRepo[],
  timestamp: number, // Date.now()
  username: string
}

// TTL: 1 heure = 3600000ms
const CACHE_TTL = 3600000;
```

#### Service GitHub
```javascript
async function fetchUserRepos(username) {
  // Vérifier cache
  const cached = getCachedRepos(username);
  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
    return cached.repos;
  }

  // Fetch API
  const response = await fetch(`https://api.github.com/users/${username}/repos`);
  if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);
  
  const repos = await response.json();
  cacheRepos(username, repos);
  return repos;
}
```

#### Filtrage client-side
```javascript
const filteredRepos = repos.filter(repo => {
  const matchesSearch = !filters.search || 
    repo.name.toLowerCase().includes(filters.search.toLowerCase()) ||
    (repo.description || '').toLowerCase().includes(filters.search.toLowerCase());
  
  const matchesLanguage = !filters.language || repo.language === filters.language;
  
  return matchesSearch && matchesLanguage;
});
```

### Gestion erreurs

**Source: design-solution-par-lot.md#Lot-4**

- **Network Error**: Afficher message, bouton réessayer, utiliser cache si disponible
- **Rate Limit**: Afficher message "Trop de requêtes", utiliser cache
- **404 User**: Afficher "Utilisateur GitHub non trouvé" (username configurable)
- **Timeout**: AbortController avec timeout 10s

### Configuration username

Pour MVP, username peut être hardcodé dans le service ou dans un fichier config. Futur : variable d'environnement `VITE_GITHUB_USERNAME`.

### Risques identifiés

1. **Rate limiting GitHub** (Impact: Moyen, Probabilité: Moyenne)
   - **Mitigation**: Cache localStorage, limiter requêtes
   - **Rollback**: Utiliser cache uniquement, pas de fetch

2. **Username incorrect** (Impact: Faible, Probabilité: Faible)
   - **Mitigation**: Gérer 404, message clair
   - **Rollback**: Hardcoder username valide

### Plan de rollback

1. **Rollback immédiat**: Désactiver fetch GitHub, afficher contenu statique
2. **Rollback partiel**: Garder service mais utiliser cache uniquement
3. **Rollback complet**: Supprimer service, restaurer Projects.jsx original

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story créée | Bob (SM) |

## Dev Agent Record
_TBD_

## QA Results
_TBD_
