# Story 3.2: Build & déploiement GitHub Pages

## Status
Draft

## Story

**As a** développeur,  
**I want** que le portfolio soit déployable automatiquement sur GitHub Pages,  
**so that** il soit accessible en production de manière reproductible.

## Contexte et objectif

### Contexte
Le portfolio doit être déployé en production. GitHub Pages est l'hébergement choisi pour ce projet statique.

### Objectif
Configurer le build production et le déploiement automatique sur GitHub Pages via GitHub Actions.

### Relation au lot
Cette story fait partie du **Lot 3 : Infrastructure & Qualité** et est critique pour la livraison.

## Scope précis

### In Scope ✅
- Configuration build production Vite (optimisations)
- Configuration GitHub Pages (base path si nécessaire)
- GitHub Actions workflow pour déploiement automatique
- Validation build production localement
- Documentation déploiement dans README

### Out of Scope ❌
- Déploiement sur autres plateformes (Vercel, Netlify)
- CI/CD avancé (tests automatiques avant déploiement - futur)
- Variables d'environnement complexes

## Acceptance Criteria

1. **AC1 - Build production**
   - `npm run build` génère build optimisé dans `dist/`
   - Build réussit sans erreurs
   - Bundle optimisé (minification, tree-shaking)

2. **AC2 - Configuration GitHub Pages**
   - Base path configuré si nécessaire (vite.config.js)
   - Assets servis correctement (images, fonts)
   - Routes fonctionnent (SPA, pas de routing mais préparation)

3. **AC3 - GitHub Actions workflow**
   - Workflow créé (`.github/workflows/deploy.yml`)
   - Déploiement automatique sur push main/master
   - Déploiement sur GitHub Pages activé

4. **AC4 - Validation locale**
   - `npm run preview` fonctionne et affiche build production
   - Vérification visuelle : tout fonctionne comme en dev
   - Pas de différences critiques dev vs prod

5. **AC5 - Documentation**
   - README mis à jour avec section déploiement
   - Instructions claires pour déploiement manuel si nécessaire
   - URL production documentée

## Impacts

### Fichiers/Modules à créer
- `.github/workflows/deploy.yml` - Workflow GitHub Actions

### Fichiers à modifier
- `vite.config.js` - Configuration base path si nécessaire
- `package.json` - Vérifier scripts build/preview
- `README.md` - Ajouter section déploiement

### Endpoints
**GitHub Pages** - Déploiement automatique

### Base de données
**Aucune**

### Dépendances npm
**Aucune nouvelle** - Vite + GitHub Actions natifs

## Tasks / Subtasks

- [ ] **Task 1: Configuration build Vite** (AC: 1)
  - [ ] Vérifier `vite.config.js` (optimisations par défaut)
  - [ ] Configurer base path si nécessaire (`base: '/os-portfolio/'` si repo name)
  - [ ] Tester `npm run build` → génère `dist/` sans erreurs

- [ ] **Task 2: Validation build local** (AC: 4)
  - [ ] Exécuter `npm run preview`
  - [ ] Vérifier visuellement : Desktop, icônes, fenêtres fonctionnent
  - [ ] Vérifier assets (images, fonts) chargés correctement
  - [ ] Tester sur navigateur (Chrome, Firefox)

- [ ] **Task 3: GitHub Actions workflow** (AC: 3)
  - [ ] Créer `.github/workflows/deploy.yml`
  - [ ] Workflow : checkout → setup Node → install deps → build → deploy Pages
  - [ ] Déclencher sur push main/master
  - [ ] Utiliser action `peaceiris/actions-gh-pages` ou équivalent

- [ ] **Task 4: Activation GitHub Pages** (AC: 3)
  - [ ] Activer GitHub Pages dans settings repo
  - [ ] Source : GitHub Actions (ou branch gh-pages)
  - [ ] Tester déploiement automatique (push test)

- [ ] **Task 5: Documentation README** (AC: 5)
  - [ ] Ajouter section "Déploiement" dans README.md
  - [ ] Instructions build local
  - [ ] Instructions déploiement GitHub Pages
  - [ ] URL production (ex: `https://username.github.io/os-portfolio/`)

- [ ] **Task 6: Tests** (AC: 1, 3, 4)
  - [ ] Test build production réussit
  - [ ] Test preview local fonctionne
  - [ ] Test déploiement GitHub Pages (URL accessible)

## Dev Notes

### Architecture technique

**Source: design-solution-par-lot.md#Lot-3**

#### Configuration Vite pour GitHub Pages
```javascript
// vite.config.js
export default {
  base: process.env.NODE_ENV === 'production' 
    ? '/os-portfolio/' // Si repo name = os-portfolio
    : '/',
  build: {
    outDir: 'dist',
    // Optimisations par défaut Vite
  }
}
```

#### GitHub Actions Workflow
```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run build
      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

#### Base Path
- Si repo = `username/os-portfolio` → base: `/os-portfolio/`
- Si repo = `username/username.github.io` → base: `/`
- Vérifier URL finale : `https://username.github.io/os-portfolio/`

### Patterns existants

**Source: etat-des-lieux.md**

- **Build**: Vite build tool déjà configuré
- **Scripts**: `npm run build`, `npm run preview` déjà présents

### Gestion d'erreurs

- **Build errors**: Vite affiche erreurs dans terminal
- **Deploy errors**: GitHub Actions logs dans Actions tab
- **Asset 404**: Vérifier base path, chemins relatifs

### Risques identifiés

1. **Base path incorrect** (Impact: Moyen, Probabilité: Moyenne)
   - **Mitigation**: Tester URL production, vérifier assets
   - **Rollback**: Ajuster base path dans vite.config.js

2. **GitHub Actions échec** (Impact: Moyen, Probabilité: Faible)
   - **Mitigation**: Vérifier logs Actions, permissions repo
   - **Rollback**: Déploiement manuel (git subtree ou gh-pages branch)

### Plan de rollback

1. **Rollback immédiat**: Désactiver GitHub Actions, déploiement manuel
2. **Rollback partiel**: Corriger workflow, redéployer
3. **Rollback complet**: Supprimer workflow, restaurer config originale

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story créée | Bob (SM) |

## Dev Agent Record
_TBD_

## QA Results
_TBD_
