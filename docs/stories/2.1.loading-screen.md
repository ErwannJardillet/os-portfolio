# Story 2.1: Loading screen au démarrage

## Status
Draft

## Story

**As a** utilisateur visitant le portfolio,  
**I want** voir un écran de chargement animé au démarrage,  
**so that** l'expérience soit professionnelle et que je sache que l'application charge.

## Contexte et objectif

### Contexte
Le portfolio nécessite un écran de chargement pour améliorer l'expérience utilisateur pendant le chargement initial des ressources (fonts, Three.js si activé).

### Objectif
Créer un écran de chargement moderne et animé qui s'affiche avant le Desktop, avec détection du chargement complet des ressources critiques.

### Relation au lot
Cette story fait partie du **Lot 2 : Animations & Loading** et précède l'animation d'entrée (Story 2.2). Séquence : LoadingScreen → EntryEffect → Desktop.

## Scope précis

### In Scope ✅
- Création composant LoadingScreen avec animation moderne
- Intégration dans App.jsx (avant Desktop)
- Détection chargement ressources critiques (fonts, images, Three.js si nécessaire)
- Transition vers animation d'entrée (Story 2.2) ou Desktop directement
- Timeout sécurité (max 3-5s) pour éviter chargement infini
- Design cohérent avec thème (glassmorphism, couleurs thème)

### Out of Scope ❌
- Animation d'entrée "waou effect" (Story 2.2)
- Barre de progression détaillée (juste animation, pas de %)
- Chargement lazy des apps (optimisation future)

## Acceptance Criteria

1. **AC1 - Composant LoadingScreen**
   - Composant LoadingScreen créé et fonctionnel
   - Animation moderne et fluide
   - Design cohérent avec thème portfolio

2. **AC2 - Affichage au démarrage**
   - LoadingScreen s'affiche immédiatement au chargement page
   - Affiche avant Desktop et tous autres éléments
   - Z-index correct (au-dessus de tout)

3. **AC3 - Détection chargement**
   - Détecte chargement complet ressources critiques (fonts, images statiques)
   - Si Three.js activé : attend chargement Three.js (optionnel, peut être asynchrone)
   - Timeout sécurité : max 3-5s, afficher Desktop même si ressources pas chargées

4. **AC4 - Transition**
   - Transition fluide vers animation d'entrée (si Story 2.2 faite) ou Desktop
   - Fade out LoadingScreen (300ms)
   - Pas de flash ou saut visuel

5. **AC5 - Gestion erreurs**
   - Si chargement échoue : afficher Desktop après timeout
   - Pas de blocage infini si ressource manquante
   - Pas d'erreur visible utilisateur

## Impacts

### Fichiers/Modules à créer
- `src/components/LoadingScreen/LoadingScreen.jsx` - Composant écran chargement
- `src/components/LoadingScreen/LoadingScreen.module.css` - Styles et animations

### Fichiers à modifier
- `src/App.jsx` - Intégrer LoadingScreen, gestion état loading
- `src/styles/global.css` ou `theme.css` - Variables couleurs si nécessaire

### Endpoints
**Aucun**

### Base de données
**Aucune**

### Dépendances npm
**Aucune nouvelle** - CSS animations natives, pas de lib externe

## Tasks / Subtasks

- [ ] **Task 1: Création composant LoadingScreen** (AC: 1)
  - [ ] Créer `src/components/LoadingScreen/LoadingScreen.jsx`
  - [ ] Créer `src/components/LoadingScreen/LoadingScreen.module.css`
  - [ ] Design : animation moderne (spinner, pulse, gradient animé, etc.)
  - [ ] Style glassmorphism cohérent avec thème
  - [ ] Animation CSS fluide (60fps)

- [ ] **Task 2: Intégration App.jsx** (AC: 2, 4)
  - [ ] Modifier `src/App.jsx`
  - [ ] Ajouter état `loadingState: 'loading' | 'entering' | 'ready'`
  - [ ] Afficher LoadingScreen si `loadingState === 'loading'`
  - [ ] Z-index LoadingScreen au-dessus de tout (z-index: 9999)

- [ ] **Task 3: Détection chargement ressources** (AC: 3)
  - [ ] Détecter chargement fonts (document.fonts.ready ou fallback)
  - [ ] Détecter chargement images critiques (si nécessaire)
  - [ ] Timeout sécurité : 3-5s max
  - [ ] Mettre à jour `loadingState` quand chargement complet ou timeout

- [ ] **Task 4: Transition vers Desktop** (AC: 4)
  - [ ] Fade out LoadingScreen (CSS transition 300ms)
  - [ ] Si Story 2.2 faite : transition vers EntryEffect
  - [ ] Sinon : transition directe vers Desktop
  - [ ] Tester transition fluide

- [ ] **Task 5: Gestion erreurs** (AC: 5)
  - [ ] Try/catch autour détection chargement
  - [ ] Timeout toujours actif (pas de blocage)
  - [ ] Logger erreurs en console (pas d'affichage utilisateur)

- [ ] **Task 6: Tests** (AC: 2, 3, 4)
  - [ ] Test affichage LoadingScreen au démarrage
  - [ ] Test transition après chargement
  - [ ] Test timeout si ressources lentes

## Dev Notes

### Architecture technique

**Source: design-solution-par-lot.md#Lot-2**

#### État loading dans App.jsx
```javascript
const [loadingState, setLoadingState] = useState('loading'); // 'loading' | 'entering' | 'ready'
```

#### Détection chargement fonts
```javascript
// Option 1: document.fonts.ready (moderne)
document.fonts.ready.then(() => {
  setLoadingState('entering'); // ou 'ready' si pas d'animation entrée
});

// Option 2: Fallback timeout
setTimeout(() => {
  setLoadingState('entering');
}, 3000); // 3s max
```

#### Séquence de chargement
```
[Page charge]
  → LoadingScreen affiché
  → Détection chargement ressources
  → Timeout 3-5s (sécurité)
  → Transition vers EntryEffect (Story 2.2) ou Desktop
```

#### Design LoadingScreen
Suggestions (à adapter selon préférences) :
- Spinner animé (CSS keyframes)
- Pulse effect sur logo/titre
- Gradient animé en arrière-plan
- Texte "Chargement..." optionnel

**Important**: Design doit être cohérent avec thème futuriste moderne, pas de gradient purple/blue par défaut (règle utilisateur).

### Patterns existants

**Source: etat-des-lieux.md#Patterns-existants**

- **CSS Modules**: Utiliser `.module.css` comme autres composants
- **State Management**: useState local dans App.jsx (pas de Context nécessaire)
- **Styling**: Variables CSS dans `theme.css` si couleurs partagées

### Gestion d'erreurs

**Source: design-solution-par-lot.md#Lot-2**

- **Loading Timeout**: Si chargement > 5s → afficher Desktop quand même
- **Animation Error**: Si animation CSS échoue → skip animation, afficher Desktop
- **ErrorBoundary**: Si Story 3.1 faite, ErrorBoundary peut capturer erreurs

### Performance

- **Durée cible**: Max 2-3s (optimisé pour ressources)
- **Animation CSS**: Utiliser transform/opacity (GPU accelerated)
- **Pas de JavaScript lourd**: Animation CSS pure, JS minimal pour détection

### Risques identifiés

1. **Chargement trop long** (Impact: Moyen, Probabilité: Faible)
   - **Mitigation**: Timeout sécurité, optimiser ressources
   - **Rollback**: Réduire timeout à 2s, simplifier animation

2. **Animation lag** (Impact: Faible, Probabilité: Faible)
   - **Mitigation**: CSS animations GPU accelerated, pas de JS dans loop
   - **Rollback**: Simplifier animation, utiliser spinner basique

### Plan de rollback

1. **Rollback immédiat**: Désactiver LoadingScreen dans App.jsx (commenter)
2. **Rollback partiel**: Garder LoadingScreen mais sans animation (statique)
3. **Rollback complet**: Supprimer composant, restaurer App.jsx original

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story créée | Bob (SM) |

## Dev Agent Record
_TBD_

## QA Results
_TBD_
