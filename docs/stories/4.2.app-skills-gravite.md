# Story 4.2: App Skills - Logo avec gravité

## Status
Draft

## Story

**As a** visiteur du portfolio,  
**I want** voir les logos de mes compétences réagir avec un effet de gravité quand je déplace la fenêtre Skills,  
**so that** l'interaction soit visuellement intéressante et démontre mes compétences techniques.

## Contexte et objectif

### Contexte
L'app Skills affiche actuellement des logos statiques. Cette story ajoute un effet de gravité physique : les logos "tombent" vers le centre de la fenêtre quand elle bouge.

### Objectif
Implémenter un système de physique basique (gravité) pour les logos dans l'app Skills, avec détection du mouvement de la fenêtre parente.

### Relation au lot
Cette story fait partie du **Lot 4 : Apps enrichies** et ajoute une interaction visuelle unique.

## Scope précis

### In Scope ✅
- Hook `useWindowPosition` pour détecter mouvement fenêtre
- Composant `SkillCanvas` avec logos positionnés
- Physique gravité basique (calcul direction centre, velocity, acceleration)
- Animation logos vers centre quand fenêtre bouge
- Stabilisation logos après arrêt mouvement
- Fallback CSS statique si WebGL/performance dégradée

### Out of Scope ❌
- WebGL/Three.js pour gravité (physique CSS/JS simple)
- Collisions entre logos (juste gravité vers centre)
- Configuration avancée (force gravité hardcodée)

## Acceptance Criteria

1. **AC1 - Détection mouvement fenêtre**
   - Hook `useWindowPosition` créé
   - Détecte changement position fenêtre parente (Window)
   - Retourne position actuelle { x, y }

2. **AC2 - Composant SkillCanvas**
   - Composant créé avec logos positionnés
   - Logos affichés dans canvas ou divs positionnées
   - Position initiale aléatoire ou grille

3. **AC3 - Physique gravité**
   - Calcul direction centre fenêtre
   - Application force gravité (velocity, acceleration)
   - Animation logos vers centre quand fenêtre bouge
   - Stabilisation après arrêt mouvement

4. **AC4 - Performance**
   - Animation fluide 60fps
   - Pas de lag lors déplacement fenêtre
   - Limiter nombre logos si performance dégradée

5. **AC5 - Fallback**
   - Si performance dégradée : désactiver gravité, afficher logos statiques
   - Si WebGL requis mais non supporté : fallback CSS statique

## Impacts

### Fichiers/Modules à créer
- `src/hooks/useWindowPosition.js` - Hook détection position fenêtre
- `src/apps/Skills/SkillCanvas.jsx` - Composant canvas logos avec physique
- `src/apps/Skills/SkillLogo.jsx` - Composant logo individuel avec position/velocity

### Fichiers à modifier
- `src/apps/Skills/Skills.jsx` - Intégrer SkillCanvas, utiliser useWindowPosition
- `src/apps/Skills/Skills.module.css` - Styles canvas, logos

### Endpoints
**Aucun**

### Base de données
**Aucune**

### Dépendances npm
**Aucune nouvelle** - Physique basique en JavaScript, pas de lib externe

## Tasks / Subtasks

- [ ] **Task 1: Hook useWindowPosition** (AC: 1)
  - [ ] Créer `src/hooks/useWindowPosition.js`
  - [ ] Détecter position fenêtre parente (via props ou Context)
  - [ ] Retourner { x, y } position actuelle
  - [ ] Mettre à jour quand position change

- [ ] **Task 2: Composant SkillLogo** (AC: 2)
  - [ ] Créer `src/apps/Skills/SkillLogo.jsx`
  - [ ] Props : position { x, y }, velocity { x, y }, logo src, name
  - [ ] Affichage logo avec position absolue
  - [ ] Style cohérent avec thème

- [ ] **Task 3: Composant SkillCanvas** (AC: 2, 3)
  - [ ] Créer `src/apps/Skills/SkillCanvas.jsx`
  - [ ] Gérer état : positions logos, velocities
  - [ ] Calcul centre fenêtre
  - [ ] Calcul force gravité (direction centre)
  - [ ] Animation avec requestAnimationFrame
  - [ ] Mettre à jour positions selon velocity/acceleration

- [ ] **Task 4: Physique gravité** (AC: 3)
  - [ ] Calcul direction : centre fenêtre - position logo
  - [ ] Application force : acceleration vers centre
  - [ ] Mise à jour velocity : velocity += acceleration * deltaTime
  - [ ] Mise à jour position : position += velocity * deltaTime
  - [ ] Friction : réduire velocity progressivement après arrêt mouvement

- [ ] **Task 5: Intégration Skills.jsx** (AC: 2, 4)
  - [ ] Modifier `src/apps/Skills/Skills.jsx`
  - [ ] Utiliser useWindowPosition (passer position fenêtre)
  - [ ] Intégrer SkillCanvas
  - [ ] Gérer fallback si performance dégradée

- [ ] **Task 6: Performance et fallback** (AC: 4, 5)
  - [ ] Mesurer FPS (optionnel, ou détection lag)
  - [ ] Si FPS < 30 : désactiver gravité, afficher statique
  - [ ] Fallback CSS statique si nécessaire
  - [ ] Limiter nombre logos si trop (max 20-30)

- [ ] **Task 7: Tests** (AC: 1, 3, 4)
  - [ ] Test détection mouvement fenêtre
  - [ ] Test gravité fonctionne (logos bougent vers centre)
  - [ ] Test performance (pas de lag)

## Dev Notes

### Architecture technique

**Source: design-solution-par-lot.md#Lot-4**

#### Modèle de données
```javascript
// État Skills
{
  skills: Skill[],
  windowPosition: { x: number, y: number },
  isDragging: boolean,
}

// Skill Model
{
  id: string,
  name: string,
  logo: string,
  category: 'language' | 'framework' | 'tool',
  position: { x: number, y: number },
  velocity: { x: number, y: number },
}
```

#### Physique gravité basique
```javascript
// Calcul direction centre
const centerX = windowWidth / 2;
const centerY = windowHeight / 2;
const dx = centerX - logoPosition.x;
const dy = centerY - logoPosition.y;
const distance = Math.sqrt(dx * dx + dy * dy);

// Force gravité (proportionnelle à distance)
const gravity = 0.5; // Constante
const forceX = (dx / distance) * gravity;
const forceY = (dy / distance) * gravity;

// Mise à jour velocity
velocity.x += forceX * deltaTime;
velocity.y += forceY * deltaTime;

// Mise à jour position
position.x += velocity.x * deltaTime;
position.y += velocity.y * deltaTime;

// Friction (réduire velocity progressivement)
velocity.x *= 0.95;
velocity.y *= 0.95;
```

#### Hook useWindowPosition
```javascript
function useWindowPosition(windowId) {
  const [position, setPosition] = useState({ x: 0, y: 0 });
  
  // Détecter position via Window component ou Context
  // Mettre à jour quand position change
  
  return position;
}
```

#### Animation requestAnimationFrame
```javascript
useEffect(() => {
  let animationId;
  
  const animate = () => {
    // Calcul physique
    updatePhysics();
    
    // Render
    setPositions(newPositions);
    
    animationId = requestAnimationFrame(animate);
  };
  
  animate();
  
  return () => cancelAnimationFrame(animationId);
}, [windowPosition]);
```

### Patterns existants

**Source: etat-des-lieux.md#Patterns-existants**

- **Hooks**: Créer custom hook (nouveau pattern pour ce projet)
- **CSS Modules**: Utiliser `.module.css`
- **State Management**: useState local dans Skills.jsx

### Gestion d'erreurs

**Source: design-solution-par-lot.md#Lot-4**

- **Performance dégradée**: Désactiver gravité automatiquement, afficher statique
- **WebGL non supporté**: Fallback CSS statique (pas de WebGL nécessaire pour cette implémentation)

### Risques identifiés

1. **Performance dégradée** (Impact: Moyen, Probabilité: Moyenne)
   - **Mitigation**: Limiter logos, optimiser calculs, détection FPS
   - **Rollback**: Désactiver gravité, afficher logos statiques

2. **Calculs physiques complexes** (Impact: Faible, Probabilité: Faible)
   - **Mitigation**: Physique basique, pas de lib externe nécessaire
   - **Rollback**: Simplifier physique, réduire force gravité

### Plan de rollback

1. **Rollback immédiat**: Désactiver gravité dans Skills.jsx (flag)
2. **Rollback partiel**: Garder code mais forcer mode statique
3. **Rollback complet**: Supprimer SkillCanvas, restaurer Skills.jsx original (logos statiques)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story créée | Bob (SM) |

## Dev Agent Record
_TBD_

## QA Results
_TBD_
