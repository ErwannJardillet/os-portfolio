# Story 3.1: Gestion d'erreurs ErrorBoundary

## Status
Draft

## Story

**As a** utilisateur du portfolio,  
**I want** que l'application ne crash pas complètement en cas d'erreur,  
**so that** je puisse continuer à utiliser le portfolio même si une partie échoue.

## Contexte et objectif

### Contexte
Le portfolio nécessite une gestion d'erreurs robuste pour éviter les crashes complets en production. React ErrorBoundary permet de capturer les erreurs et afficher un fallback.

### Objectif
Implémenter ErrorBoundary React pour capturer les erreurs, logger les erreurs, et afficher une UI de fallback élégante avec possibilité de recharger.

### Relation au lot
Cette story fait partie du **Lot 3 : Infrastructure & Qualité** et est critique pour la stabilité en production.

## Scope précis

### In Scope ✅
- Création composant ErrorBoundary (class component React)
- Création composant ErrorFallback (UI de fallback)
- Intégration ErrorBoundary autour de Desktop dans App.jsx
- Logging erreurs (console.error)
- UI fallback : message clair + bouton "Recharger la page"
- Style cohérent avec thème (glassmorphism)

### Out of Scope ❌
- Service de logging externe (Sentry, etc.) - console uniquement pour MVP
- Analytics erreurs - futur
- Récupération automatique - juste rechargement manuel

## Acceptance Criteria

1. **AC1 - Composant ErrorBoundary**
   - ErrorBoundary créé (class component, requis par React)
   - Capture erreurs React (componentDidCatch)
   - Affiche ErrorFallback en cas d'erreur

2. **AC2 - Composant ErrorFallback**
   - UI de fallback créée et fonctionnelle
   - Message clair pour l'utilisateur
   - Bouton "Recharger la page" fonctionnel

3. **AC3 - Intégration App.jsx**
   - ErrorBoundary enveloppe Desktop dans App.jsx
   - Capture erreurs dans Desktop et enfants
   - Ne capture pas erreurs dans ErrorBoundary lui-même

4. **AC4 - Logging erreurs**
   - Erreurs loggées dans console.error
   - Informations utiles : error, errorInfo.componentStack
   - Pas d'affichage technique à l'utilisateur

5. **AC5 - Design cohérent**
   - Style glassmorphism cohérent avec thème
   - Message utilisateur-friendly (pas de stack trace)
   - Bouton style cohérent avec autres composants

## Impacts

### Fichiers/Modules à créer
- `src/components/ErrorBoundary/ErrorBoundary.jsx` - Class component ErrorBoundary
- `src/components/ErrorBoundary/ErrorFallback.jsx` - Composant UI fallback
- `src/components/ErrorBoundary/ErrorFallback.module.css` - Styles fallback

### Fichiers à modifier
- `src/App.jsx` - Envelopper Desktop avec ErrorBoundary

### Endpoints
**Aucun**

### Base de données
**Aucune**

### Dépendances npm
**Aucune nouvelle** - React ErrorBoundary natif

## Tasks / Subtasks

- [ ] **Task 1: Création ErrorBoundary** (AC: 1)
  - [ ] Créer `src/components/ErrorBoundary/ErrorBoundary.jsx`
  - [ ] Implémenter class component avec componentDidCatch
  - [ ] Gérer état : `hasError: boolean`, `error: Error | null`, `errorInfo: ReactErrorInfo | null`
  - [ ] Si erreur : rendre ErrorFallback, sinon rendre children

- [ ] **Task 2: Création ErrorFallback** (AC: 2, 5)
  - [ ] Créer `src/components/ErrorBoundary/ErrorFallback.jsx`
  - [ ] Créer `src/components/ErrorBoundary/ErrorFallback.module.css`
  - [ ] Message utilisateur-friendly : "Une erreur s'est produite"
  - [ ] Bouton "Recharger la page" (window.location.reload())
  - [ ] Style glassmorphism cohérent avec thème

- [ ] **Task 3: Intégration App.jsx** (AC: 3)
  - [ ] Modifier `src/App.jsx`
  - [ ] Envelopper Desktop avec ErrorBoundary
  - [ ] Tester que ErrorBoundary capture erreurs Desktop

- [ ] **Task 4: Logging erreurs** (AC: 4)
  - [ ] Logger error dans componentDidCatch (console.error)
  - [ ] Logger errorInfo.componentStack si disponible
  - [ ] Pas d'affichage stack trace à l'utilisateur

- [ ] **Task 5: Tests** (AC: 1, 3)
  - [ ] Test ErrorBoundary capture erreur (throw error dans composant test)
  - [ ] Test ErrorFallback affiché correctement
  - [ ] Test bouton rechargement fonctionne

## Dev Notes

### Architecture technique

**Source: design-solution-par-lot.md#Lot-3**

#### ErrorBoundary Pattern React
```javascript
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null, errorInfo: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('ErrorBoundary caught error:', error, errorInfo);
    this.setState({ error, errorInfo });
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback onReload={() => window.location.reload()} />;
    }
    return this.props.children;
  }
}
```

#### Intégration App.jsx
```jsx
<ErrorBoundary>
  <Desktop />
</ErrorBoundary>
```

#### ErrorFallback UI
- Message : "Une erreur s'est produite. Veuillez recharger la page."
- Bouton : "Recharger la page" → window.location.reload()
- Style : Glassmorphism, centré, cohérent avec thème

### Patterns existants

**Source: etat-des-lieux.md#Patterns-existants**

- **CSS Modules**: Utiliser `.module.css`
- **Class Component**: Exception nécessaire pour ErrorBoundary (React requirement)

### Gestion d'erreurs

**Source: design-solution-par-lot.md#Lot-3**

- **ErrorBoundary Strategy**: Capturer erreurs React, logger, afficher fallback
- **Error Logging**: Console uniquement (pas de service externe pour MVP)
- **Fallback UI**: Toujours afficher quelque chose (pas d'écran blanc)

### Limitations ErrorBoundary

- **Ne capture pas**: Erreurs dans event handlers, async code, SSR, ErrorBoundary lui-même
- **Capture**: Erreurs dans render, lifecycle methods, constructors

### Risques identifiés

1. **Erreurs non capturées** (Impact: Moyen, Probabilité: Faible)
   - **Mitigation**: ErrorBoundary autour Desktop, try/catch dans handlers critiques
   - **Rollback**: N/A (ErrorBoundary est défensif, ne casse rien)

2. **Fallback UI pas visible** (Impact: Faible, Probabilité: Faible)
   - **Mitigation**: Tester z-index, positionnement
   - **Rollback**: Ajuster styles ErrorFallback

### Plan de rollback

1. **Rollback immédiat**: Retirer ErrorBoundary de App.jsx (commenter)
2. **Rollback partiel**: Garder ErrorBoundary mais sans ErrorFallback (juste console.error)
3. **Rollback complet**: Supprimer composants, restaurer App.jsx original

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story créée | Bob (SM) |

## Dev Agent Record
_TBD_

## QA Results
_TBD_
