# Story 1.3: App Settings - Switch fonds d'écran

## Status
Draft

## Story

**As a** utilisateur du portfolio,  
**I want** pouvoir changer de fond d'écran via une interface Settings,  
**so that** je puisse personnaliser l'apparence selon mes préférences.

## Contexte et objectif

### Contexte
Cette story crée l'application Settings permettant de changer entre les différents fonds d'écran disponibles (sphères 3D, shader-gradient).

### Objectif
Créer une interface utilisateur simple pour sélectionner et changer de fond d'écran, avec persistance de la préférence dans localStorage.

### Dépendances
- **Requiert Story 1.1** : Sphères 3D doivent être fonctionnelles
- **Requiert Story 1.2** : ShaderGradient doit être intégré
- **Prérequis pour** : Aucune (story finale du Lot 1)

## Scope précis

### In Scope ✅
- Création app Settings (nouveau dossier `src/apps/Settings/`)
- Interface liste fonds disponibles avec preview
- Sélection et changement de fond (via Context WallpaperProvider)
- Persistance préférence localStorage
- Restauration préférence au chargement
- Transition fluide entre fonds (fade 300ms)
- Intégration Settings dans Desktop (icône + ouverture fenêtre)

### Out of Scope ❌
- Configuration avancée (nombre sphères, couleurs) - hardcodé pour MVP
- Autres paramètres Settings (thème, audio) - futures stories
- Prévisualisation en temps réel (juste liste + changement immédiat)

## Acceptance Criteria

1. **AC1 - App Settings créée**
   - Dossier `src/apps/Settings/` avec composant Settings.jsx
   - Settings s'ouvre comme fenêtre normale (via DesktopIcon)
   - Interface liste fonds disponibles

2. **AC2 - Liste fonds disponibles**
   - Affichage liste : "Sphères 3D", "Shader Gradient"
   - Indication fond actuel (checkmark ou highlight)
   - Design cohérent avec thème (glassmorphism)

3. **AC3 - Changement de fond**
   - Clic sur un fond change immédiatement le fond d'écran
   - Transition fluide (fade 300ms)
   - Pas de flash ou saut visuel

4. **AC4 - Persistance localStorage**
   - Préférence sauvegardée dans localStorage (key: 'os-portfolio-wallpaper')
   - Au refresh, fond restauré automatiquement
   - Gestion erreurs localStorage (quota exceeded, disabled)

5. **AC5 - Intégration Desktop**
   - Icône Settings ajoutée au Desktop
   - Double-clic ouvre fenêtre Settings
   - Settings fonctionne comme les autres apps (drag, close, focus)

## Impacts

### Fichiers/Modules à créer
- `src/apps/Settings/Settings.jsx` - Composant principal Settings
- `src/apps/Settings/Settings.module.css` - Styles Settings

### Fichiers à modifier
- `src/components/Desktop/Desktop.jsx` - Ajouter icône Settings, componentMap
- `src/components/Wallpaper/WallpaperProvider.jsx` - Ajouter méthode `setWallpaper()`, persistance localStorage
- `src/constants/wallpaper.js` - Exporter labels affichables des fonds

### Endpoints
**Aucun**

### Base de données
**localStorage** (navigateur) - Key: `'os-portfolio-wallpaper'`, Value: `'spheres-3d' | 'shader-gradient'`

### Dépendances npm
**Aucune nouvelle** - Utilise localStorage natif

## Tasks / Subtasks

- [ ] **Task 1: Création app Settings** (AC: 1)
  - [ ] Créer `src/apps/Settings/Settings.jsx`
  - [ ] Créer `src/apps/Settings/Settings.module.css`
  - [ ] Structure basique : titre "Paramètres", section "Fond d'écran"

- [ ] **Task 2: Liste fonds disponibles** (AC: 2)
  - [ ] Créer composant liste (ou section dans Settings)
  - [ ] Afficher "Sphères 3D" et "Shader Gradient"
  - [ ] Utiliser Context WallpaperProvider pour récupérer fond actuel
  - [ ] Indiquer fond actuel visuellement (checkmark, highlight, etc.)
  - [ ] Style glassmorphism cohérent avec thème

- [ ] **Task 3: Changement de fond** (AC: 3)
  - [ ] Ajouter méthode `setWallpaper(type)` dans WallpaperProvider
  - [ ] Implémenter handler clic sur fond dans Settings
  - [ ] Appeler `setWallpaper()` avec nouveau type
  - [ ] Ajouter transition CSS (fade 300ms) entre fonds
  - [ ] Tester transition fluide

- [ ] **Task 4: Persistance localStorage** (AC: 4)
  - [ ] Modifier WallpaperProvider pour sauvegarder dans localStorage
  - [ ] Key: `'os-portfolio-wallpaper'`
  - [ ] Sauvegarder à chaque changement (dans `setWallpaper()`)
  - [ ] Charger préférence au mount (useEffect initial)
  - [ ] Gérer erreurs : try/catch, fallback si localStorage disabled/quota exceeded

- [ ] **Task 5: Intégration Desktop** (AC: 5)
  - [ ] Modifier `src/components/Desktop/Desktop.jsx`
  - [ ] Ajouter Settings dans componentMap
  - [ ] Ajouter icône Settings dans iconPositions initiales
  - [ ] Créer icône Settings (ou utiliser placeholder)
  - [ ] Tester ouverture/fermeture Settings comme autres apps

- [ ] **Task 6: Tests** (AC: 3, 4)
  - [ ] Test changement fond fonctionne
  - [ ] Test persistance localStorage (sauvegarde + restauration)
  - [ ] Test gestion erreurs localStorage

## Dev Notes

### Architecture technique

**Source: design-solution-par-lot.md#Lot-1**

#### Modèle de données localStorage
```javascript
// localStorage key: 'os-portfolio-wallpaper'
// Value: 'spheres-3d' | 'shader-gradient'
// Format: string simple (pas de JSON nécessaire pour MVP)
```

#### WallpaperProvider mis à jour
```javascript
// Ajouter méthode dans Context
const setWallpaper = (type) => {
  setCurrentWallpaper(type);
  // Sauvegarder localStorage
  try {
    localStorage.setItem('os-portfolio-wallpaper', type);
  } catch (e) {
    console.warn('Failed to save wallpaper preference:', e);
  }
};

// Charger au mount
useEffect(() => {
  try {
    const saved = localStorage.getItem('os-portfolio-wallpaper');
    if (saved && WALLPAPER_TYPES[saved]) {
      setCurrentWallpaper(saved);
    }
  } catch (e) {
    console.warn('Failed to load wallpaper preference:', e);
  }
}, []);
```

#### Transition entre fonds
Utiliser CSS transition sur opacité des composants Wallpaper :
- Fade out ancien fond (300ms)
- Fade in nouveau fond (300ms)
- Ou utiliser React transition group si nécessaire

#### Labels affichables
Créer mapping dans constants :
```javascript
export const WALLPAPER_LABELS = {
  'spheres-3d': 'Sphères 3D',
  'shader-gradient': 'Shader Gradient',
};
```

### Patterns existants

**Source: etat-des-lieux.md#Patterns-existants**

- **Apps structure**: Suivre même pattern que About, Contact, Projects, Skills
- **ComponentMap**: Ajouter Settings dans componentMap de Desktop.jsx
- **CSS Modules**: Utiliser `.module.css` comme autres apps

### Gestion erreurs localStorage

**Source: design-solution-par-lot.md#Lot-6**

- **Quota exceeded**: Try/catch, continuer sans persistance
- **localStorage disabled**: Try/catch, continuer sans persistance
- **Invalid data**: Valider avant utilisation, fallback vers 'spheres-3d' par défaut

### Risques identifiés

1. **localStorage quota** (Impact: Faible, Probabilité: Faible)
   - **Mitigation**: Try/catch, continuer sans persistance
   - **Rollback**: Désactiver persistance, fond par défaut toujours 'spheres-3d'

2. **Transition visuelle** (Impact: Faible, Probabilité: Faible)
   - **Mitigation**: Tester transition, ajuster timing si nécessaire
   - **Rollback**: Transition instantanée (pas de fade)

### Plan de rollback

1. **Rollback immédiat**: Désactiver icône Settings dans Desktop
2. **Rollback partiel**: Garder Settings mais sans persistance
3. **Rollback complet**: Supprimer app Settings, restaurer Desktop.jsx

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Story créée | Bob (SM) |

## Dev Agent Record
_TBD_

## QA Results
_TBD_
